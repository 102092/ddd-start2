# 도메인 주도 개발 시작하기

## 환경 설정

1. docker run
```bash
 docker run --name mysql5.7.38 -e MYSQL_ROOT_PASSWORD=root -p 3308:3306 -d mysql:5.7.38 --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
```

- 현재 `3306` 포트 점유 중이므로, `3307` 로 변경

2. ddl.sql 실행
3. init.sql 실행
4. application 실행
   1. server.port : 8081 변경
   2. datasource의 url 변경


## 정리

### annotation

- `@EmbeddedId`
  - [참고](https://1minute-before6pm.tistory.com/17)
  - 복합키 사용을 위한 어노테이션
- `@Embedded`
  - [참고1](https://www.baeldung.com/jpa-embedded-embeddable)
  - [참고2](https://galid1.tistory.com/592)
  - 클래스로 그 내용을 entity에 끼어넣기 위함.
  - Embed...들은 Entity의 가독성을 높히기 위함인듯 (복잡도를 낮추기 위함) 

### 읽으면서..

#### 1ch

- 일반적인 애플리케이션의 구조는 [표현 - 응용 - 도메인 - 인프라스트럭처]
  - 표현은 UI
  - 응용은 서비스, 뭔가 조합해서 처리하는 거
  - 도메인은 말그대로 도메인. 도메인에는 규칙이 있음.
  - 인프라스트럭처는 데이터베이스 혹은 외부시스템과의 연계
- 비즈니스 구현에 있어서, 중요한 규칙은 도메인에 구현되어야함.
  - 예를 들면 '배송 전에만 배송지를 변경할 수 있다' 라는 검증 로직은 도메인이 담당해야한다.
  - 왜?
  - 그게 도메인 주도..?
- 생성자에는 반드시 필요한 것을 넘긴다.
- 엔티티 식별자(id)를 가짐, 식별자로 구별함.
- 밸류는 식별자 대신 다른 걸 통해, 동일성을 판단.
- 유비쿼터스 언어. 전문가, 관계자, 개발자가 공통된 언어를 사용해서 소통과정에서의 모호함을 줄일 수 있도록..

#### 2ch

- 표현 계층은 응용 계층에 의존하고 응용 계층이 도메인 계층에 의존하지만, 반대로 인프라스트럭처 계층이 도메인에 의존하거나, 도메인이 응용 계층에 의존하지는 않는다.
- 표현 -> 인프라스트럭처 이런식으로 의존하게 만들면 ,테스트 작성하거나 기능확장하기가 어렵다.
- DIP 의존 역전 원치
  - 저순 모듈이, 고수준 모듈에 의존한다.
  - 고수준, 저수준은 상대적인 것. 만약에 도메인 - 인프라가 있으면 도메인은 고수준, 인프라는 저수준이다.
  - 구현 객체가 (JPA로 데이터를 가져올지 혹은 Drool로 가져올 지, 구체적으로 코드로 구현된 저수준 객체) 가 인터페이스에 의존하고 있는 현상 (고수준, 추상화 되어있음.) 이 DIP
  - 인터페이스를 통해 기능이 구현된 응용 계층에서는, 어떤 저수준 모듈을 사용하는 지 알 필요 없게됨.
  - 생성자로 인터페이스를 받아라 하는게 DIP를 지키고 나아가 테스트나 기능 확장을 쉽게하려는 목적
- 엔티티
  - 고유 식별자를 갖는 객체 
  - e.g 주문, 회원, 상품..
  - 단순히 데이터를 담고 있기 보다는, 데이터와 함께 **기능**을 제공함.
  - 밸류의 집합으로 구성될 수도 있음.
- 밸류
  - 고육 식별자를 갖지 않는 객체
  - e.g Address, Money...
  - 불변으로 구현할 것을 권장
- 애그리거트 aggregate
  - 엔티티와 밸류를 개념적으로 하나로 묶은 것.
  - 주문 애그리거트 = Order(도메인), OrderLine(밸류), Orderer(밸류)
- 리포지터리 repository
  - 도메인 모델의 영속성을 처리하는 객체
  - 즉 물리적인 저장소에 도메인을 저장하기 위한 계층, 저수준 모듈로 인프라스트럭처 영역에 해당함.
  - DBMS에 저장 혹은 로딩...
- 도메인 서비스 domain service
  - 특정 엔티티에 속하지 않은 도메인 로직을 제공.
  - 할인 금액 계산을 하기 위해선 도메인 서비스가 필요함.
- 응용 서비스는 의존 주입등을 통해, 실제 리포지터리 구현 객체에 접근함.
- 도메인, 응용영역에서 인프라스트럭처의 기능을 직접 사용하는 것보다, 이 두 영역에 정의한 인터페이스를 인프라스트럭처 영역에서 구현하는 것이 시스템을 더 유연하고 테스트하기 쉽게 만든다.
  - 무조건 그런것은 아님.
  - 예를 들면 `@Transactional` 이나 영속성을 위한 `@Entity`, `@Table` 같은 어노테이션은 응용, 도메인 객체에서 사용하는 것이 낫다.
- ui -> application -> domain <- infrastructure
  - 패키지를 나누는 것도, 정해진 건 없다. 다만 합의가 필요한 부분.
  - 그리고 한 패키지에 너무 많은 정보를 담고 있지 않게 하는게 좋을듯. 많아지면 나누는 걸 시도.